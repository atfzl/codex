<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
    <style>
      #code {
        border: 1px solid black;
        padding: 4px;
        font-family: monospace;
        height: 400px;
      }
      .container {
        display: flex;
        flex-direction: column;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <pre id="code"></pre>
      <input type="range" id="slider" name="slider" min="0" max="0" />
    </div>

    <script>
      const http = require("http");
      const fs = require("fs").promises;
      const WebSocket = require("ws");

      const server = http.createServer();
      const wss = new WebSocket.Server({ server });

      const values = [];
      const $slider = document.getElementById("slider");
      const $code = document.getElementById("code");

      $slider.onchange = (e) => {
        const index = e.target.value;
        if (index < values.length) {
          const dataPoint = values[index];
          fs.readFile(dataPoint.path, "utf8").then((data) => {
            $code.innerText = data;
          });
        }
      };

      wss.on("connection", function connection(ws) {
        console.log("connection created");
        ws.on("message", function incoming(message) {
          const parsedMessage = JSON.parse(message);
          console.log("received message", parsedMessage);
          values.push(parsedMessage);
          $slider.setAttribute("max", values.length);
        });
      });

      server.listen(8090, () => {
        console.log("http server started on port 8090");
      });
    </script>
  </body>
</html>
